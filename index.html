<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Globo da Rede â€“ Visual Presenter</title>

<!-- DependÃªncias fixas -->
<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/globe.gl@2.32.3/dist/globe.gl.min.js"></script>

<style>
  #globe {
  flex: 1;
  position: relative;
  overflow: hidden;
  z-index: 0;   /* garante que fique atrÃ¡s */
}
aside {
  z-index: 1;   /* garante que fique na frente */
  position: relative;
}
#globe canvas {
  position: absolute !important;
  top: 0; left: 0;
  width: 100% !important;
  height: 100% !important;
}
  html, body { height:100%; margin:0; background:#000; overflow:hidden; font-family:Segoe UI,Roboto,sans-serif; color:#fff; }
  #layout { display:flex; height:100%; width:100%; }
  #globe  { flex:1; position:relative; min-height:300px; }
  aside{width:320px;background:#111c2b;border-right:1px solid #22334a;padding:12px;overflow:auto}
  h1{margin:0 0 10px;font-size:18px;color:#00e5ff}
  button,input,select,textarea{font:inherit}
  .btn{padding:6px 10px;margin:2px;border:1px solid #22334a;border-radius:6px;background:#1a283d;color:#fff;cursor:pointer}
  .btn:hover{filter:brightness(1.2)}
  .btn-danger{background:#3a1a1a;border-color:#5c2a2a;color:#ffd6d6}
  ul{list-style:none;padding:0;margin:0}
  li{padding:6px;border-radius:6px;margin:2px 0;background:#1b2a3e;display:flex;justify-content:space-between;align-items:center}
  li span{cursor:pointer}
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;z-index:50}
  .modal.open{display:flex}
  .modal .box{background:#111c2b;border:1px solid #22334a;border-radius:8px;padding:12px;width:min(90vw,480px)}
  #err{position:fixed;bottom:10px;right:10px;background:#321b1b;color:#ffd6d6;padding:8px 10px;border:1px solid #5b2b2b;border-radius:8px;display:none;z-index:99}
</style>
</head>
<body>
  <div id="layout">
 <div id="layout" style="display:flex; height:100vh; width:100vw;">
  <aside> ... </aside>
  <main id="globe"></main>
</div>

      <h2>Pontos</h2>
      <form id="pointForm">
        <input type="hidden" id="pointId">
        <input id="pointName" placeholder="Nome" required class="btn" style="width:100%">
        <select id="pointType" class="btn" style="width:100%">
          <option value="torre">Torre</option>
          <option value="cliente">Cliente</option>
          <option value="pop">POP</option>
        </select>
        <input id="pointLat" type="number" step="0.0001" placeholder="Latitude" required class="btn" style="width:100%">
        <input id="pointLng" type="number" step="0.0001" placeholder="Longitude" required class="btn" style="width:100%">
        <textarea id="pointDesc" placeholder="DescriÃ§Ã£o" class="btn" style="width:100%"></textarea>
        <input id="pointImgUrl" type="url" placeholder="URL da imagem" class="btn" style="width:100%">
        <button type="submit" class="btn">Salvar</button>
      </form>

      <ul id="pointsList"></ul>

      <h2>Links</h2>
      <select id="arcStart" class="btn" style="width:100%"></select>
      <select id="arcEnd" class="btn" style="width:100%"></select>
      <input id="arcLabel" placeholder="RÃ³tulo" class="btn" style="width:100%">
      <button id="btnAddArc" class="btn">Criar Link</button>
      <ul id="arcsList"></ul>
    </aside>

    <!-- Globo -->
    <main id="globe"></main>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal">
    <div class="box">
      <h3 id="mTitle"></h3>
      <p id="mDesc"></p>
      <img id="mImg" src="" style="width:100%;border-radius:6px">
      <div>
        <button id="mClose" class="btn">Fechar</button>
      </div>
    </div>
  </div>

  <div id="err"></div>

<script>
const LS_POINTS="globe_points_demo", LS_ARCS="globe_arcs_demo";
const pinColors={torre:"orange",cliente:"dodgerblue",pop:"limegreen"};
let points=JSON.parse(localStorage.getItem(LS_POINTS)||"[]");
let arcs=JSON.parse(localStorage.getItem(LS_ARCS)||"[]");

function save(){localStorage.setItem(LS_POINTS,JSON.stringify(points));localStorage.setItem(LS_ARCS,JSON.stringify(arcs));}
function uuid(){return crypto.randomUUID?crypto.randomUUID():Date.now()+"";}

const g=Globe()(document.getElementById("globe"))
  .globeImageUrl("//unpkg.com/three-globe/example/img/earth-dark.jpg")
  .bumpImageUrl("//unpkg.com/three-globe/example/img/earth-topology.png")
  .backgroundImageUrl("//unpkg.com/three-globe/example/img/night-sky.png")
  .pointAltitude(0.02).pointRadius(0.4)
  .pointColor(p=>pinColors[p.type]||"cyan")
  .onPointClick(p=>openModal(p));

g.controls().autoRotate=true;g.controls().autoRotateSpeed=0.6;

function fit(){const el=document.getElementById("globe");g.width(el.clientWidth||window.innerWidth);g.height(el.clientHeight||window.innerHeight);}
document.addEventListener("DOMContentLoaded",fit);
window.addEventListener("load",()=>setTimeout(fit,100));
window.addEventListener("resize",fit);

function refresh(){g.pointsData(points);g.arcsData(arcs);}
refresh();

/* UI */
const pointsList=document.getElementById("pointsList");
function renderPoints(){pointsList.innerHTML="";points.forEach(p=>{const li=document.createElement("li");li.innerHTML=`<span>${p.name}</span><div><button onclick="delPoint('${p.id}')">ðŸ—‘</button></div>`;li.querySelector("span").onclick=()=>g.pointOfView({lat:p.lat,lng:p.lng,altitude:1.3},900);pointsList.appendChild(li);});}
function delPoint(id){points=points.filter(p=>p.id!==id);arcs=arcs.filter(a=>a.start!==id&&a.end!==id);save();renderPoints();renderArcs();refresh();}

const arcsList=document.getElementById("arcsList");
function renderArcs(){arcsList.innerHTML="";arcs.forEach(a=>{const li=document.createElement("li");const s=points.find(p=>p.id===a.start),e=points.find(p=>p.id===a.end);if(!s||!e)return;li.textContent=a.label||`${s.name}â†”${e.name}`;arcsList.appendChild(li);});}

document.getElementById("pointForm").onsubmit=e=>{
  e.preventDefault();
  const p={id:document.getElementById("pointId").value||uuid(),
    name:document.getElementById("pointName").value,
    type:document.getElementById("pointType").value,
    lat:parseFloat(document.getElementById("pointLat").value),
    lng:parseFloat(document.getElementById("pointLng").value),
    description:document.getElementById("pointDesc").value,
    img:document.getElementById("pointImgUrl").value};
  points=points.filter(x=>x.id!==p.id).concat([p]);save();renderPoints();refresh();e.target.reset();
};

document.getElementById("btnAddArc").onclick=()=>{
  const s=document.getElementById("arcStart").value,e=document.getElementById("arcEnd").value;
  if(s&&e&&s!==e){arcs.push({id:uuid(),start:s,end:e,label:document.getElementById("arcLabel").value});save();renderArcs();refresh();}
};

function populateArcSelectors(){const opts=points.map(p=>`<option value="${p.id}">${p.name}</option>`).join("");document.getElementById("arcStart").innerHTML=opts;document.getElementById("arcEnd").innerHTML=opts;}
populateArcSelectors();

document.getElementById("btnSeed").onclick=()=>{
  points=[{id:uuid(),lat:-23.55,lng:-46.63,name:"POP SÃ£o Paulo",type:"pop",description:"SP",img:""},
          {id:uuid(),lat:-22.90,lng:-43.17,name:"Torre Rio",type:"torre",description:"RJ",img:""}];
  arcs=[{id:uuid(),start:points[0].id,end:points[1].id,label:"SP-RJ"}];save();renderPoints();renderArcs();refresh();populateArcSelectors();
};
document.getElementById("btnClear").onclick=()=>{points=[];arcs=[];save();renderPoints();renderArcs();refresh();};

function openModal(p){document.getElementById("mTitle").textContent=p.name;document.getElementById("mDesc").textContent=p.description||"";document.getElementById("mImg").src=p.img||"https://placehold.co/600x400";document.getElementById("modal").classList.add("open");}
document.getElementById("mClose").onclick=()=>document.getElementById("modal").classList.remove("open");

/* Render inicial */
renderPoints();renderArcs();refresh();

/* Debug de erro */
if(typeof Globe==="undefined") showErr("Falha ao carregar globe.gl");
if(typeof THREE==="undefined") showErr("Falha ao carregar three.js");
if(!("WebGLRenderingContext" in window)) showErr("Seu navegador nÃ£o suporta WebGL");
function showErr(msg){const e=document.getElementById("err");e.textContent=msg;e.style.display="block";}
</script>
</body>
</html>

